"use strict";var transitApiKey="GtcxZUCX28g3094pNheS",mapboxgKey="pk.eyJ1Ijoic2hlcjEwY2siLCJhIjoiY2thNXUwaGR0MDBsYzJzcGJuN3pyNm9zZCJ9.7g0y2GWDRHDu7ClTgmD0NQ",originForm=document.querySelector(".origin-form"),destForm=document.querySelector(".destination-form"),originsEle=document.querySelector(".origins"),destinationsEle=document.querySelector(".destinations"),launchBtn=document.querySelector("button"),geometries={origin:[],destination:[]};function getGeomtries(t){var n=t.target.closest("ul").children,e=t.target.closest("li");if(0!==n.length){for(var i=0;i<n.length;i++)n[i].classList.remove("selected");e.classList.toggle("selected"),t.target.closest("ul").classList.contains("origins")?geometries.origin=[e.dataset.long,e.dataset.lat]:geometries.destination=[e.dataset.long,e.dataset.lat]}}function displayTripPlanner(t){fetch("https://api.winnipegtransit.com/v3/trip-planner.json?api-key=".concat(transitApiKey,"&origin=geo/").concat(t.origin[1],",").concat(t.origin[0],"&destination=geo/").concat(t.destination[1],",").concat(t.destination[0])).then(function(t){if(t.ok)return t.json();throw new Error("invalid input")}).then(function(t){insertTripPlan(t)})}function insertTripPlan(t){var n=t.plans[0].segments,e=document.querySelector(".my-trip");e.innerHTML="";for(var i='\n      <li>\n        <i class="fas fa-walking" aria-hidden="true"></i>Walk for '.concat(n[0].times.durations.total," minutes to stop #").concat(n[0].to.stop.key," - ").concat(n[0].to.stop.name,"\n      </li>"),o=1;o<n.length-1;o++)"ride"===n[o].type?(bus=void 0===n[o].route.name?n[o].route.key:n[o].route.name,i+='\n      <li>\n        <i class="fas fa-bus" aria-hidden="true"></i>Ride the '.concat(bus," for ").concat(n[o].times.durations.total," minutes.\n      </li>\n      ")):"transfer"===n[o].type&&(i+='\n      <li>\n        <i class="fas fa-ticket-alt" aria-hidden="true"></i>Transfer from stop\n        #'.concat(n[o].from.stop.key," - ").concat(n[o].from.stop.name," to stop #").concat(n[o].to.stop.key," - ").concat(n[o].to.stop.name,"\n      </li>\n      "));i+='\n    <li>\n      <i class="fas fa-walking" aria-hidden="true"></i>Walk for '.concat(n[n.length-1].times.durations.total," minutes to your destination.\n    </li>"),e.innerHTML=i}function displayLocations(t,n){n.preventDefault(),fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(t,".json?access_token=").concat(mapboxgKey,"&limit=10&bbox=-97.325875, 49.766204, -96.953987, 49.99275")).then(function(t){return t.json()}).then(function(t){insertLocationList(t,n)})}function insertLocationList(t,n){var e="";t.features.forEach(function(t){void 0!==t.properties.address?e+='<li data-long="'.concat(t.geometry.coordinates[0],'" data-lat="').concat(t.geometry.coordinates[1],'" class="">\n        <div class="name">').concat(t.text,"</div>\n        <div>").concat(t.properties.address,"</div>\n      </li>"):e+='<li data-long="'.concat(t.geometry.coordinates[0],'" data-lat="').concat(t.geometry.coordinates[1],'" class="">\n        <div class="name">').concat(t.text,"</div>\n        <div>").concat(t.context[0].text,"</div>\n      </li>")}),n.target===originForm?(originsEle.innerHTML="",originsEle.insertAdjacentHTML("afterbegin",e)):n.target===destForm&&(destinationsEle.innerHTML="",destinationsEle.insertAdjacentHTML("afterbegin",e))}originForm.onsubmit=function(t){displayLocations(t.target.firstElementChild.value,t)},destForm.onsubmit=function(t){displayLocations(t.target.firstElementChild.value,t)},originsEle.onclick=function(t){getGeomtries(t)},destinationsEle.onclick=function(t){getGeomtries(t)},launchBtn.onclick=function(t){0!==geometries.origin.length&&0!==geometries.destination.length&&displayTripPlanner(geometries)};